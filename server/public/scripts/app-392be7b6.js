"use strict";angular.module("archCarto",["ngAnimate","ngCookies","ngTouch","ngSanitize","ngMessages","ui.router","ngMaterial","pascalprecht.translate","leaflet-directive","angularFileUpload","base64"]).config(["$translateProvider","$stateProvider","$urlRouterProvider","i18nfrFRConstant","i18nenUSConstant","$mdThemingProvider",function(e,t,a,n,r,o){L.AwesomeMarkers.Icon.prototype.options.prefix="fa",o.theme("default").primaryPalette("green").accentPalette("lime"),o.theme("pathDrawer").primaryPalette("teal").accentPalette("blue-grey"),t.state("main",{url:"/",views:{main:{templateUrl:"app/main/main.html"}}}).state("map",{url:"/map","abstract":!0,views:{main:{template:'<arch-map layout="column" layout-fill></arch-map>'}}}).state("map.home",{url:"",views:{sideNavLeft:{template:"<arch-map-side-nav-left></arch-map-side-nav-left>"}}}).state("map.poi",{url:"/poi",views:{sideNavLeft:{template:"<arch-map-side-nav-poi-left></arch-map-side-nav-poi-left>"},sideNavRight:{template:"<arch-map-side-nav-poi-right></arch-map-side-nav-poi-right>"}}}).state("map.bug",{url:"/bug",views:{sideNavLeft:{template:"<arch-map-side-nav-bug-left></arch-map-side-nav-bug-left>"},sideNavRight:{template:"<arch-map-side-nav-bug-right></arch-map-side-nav-bug-right>"}}}).state("map.path",{url:"/path",views:{sideNavLeft:{template:"<arch-map-side-nav-path-left></arch-map-side-nav-path-left>"}}}).state("map.gpx",{url:"/path",views:{sideNavLeft:{template:"<arch-gpx-upload-form></arch-gpx-upload-form>"}}}),a.otherwise("/"),e.translations("fr",n).translations("en",r).preferredLanguage("fr")}]),angular.module("archCarto").constant("i18nfrFRConstant",{CUSTOMER_NAME:"ArchCarto",CUSTOMER_DESC:"Planificateur de Parcours de Randonnées",MAIN_PAGE_HOME:"Accueil",MAIN_PAGE_ABOUTUS:"A propos",MAIN_PAGE_SERVICES:"Services",MAIN_PAGE_LOGIN:"Connexion",MAIN_PAGE_LOGOUT:"Déconnexion",MAIN_PAGE_SIGNIN:"Inscription",MAIN_PAGE_MAP:"Carte",MAIN_PAGE_BACKTOTOP:"Revenir en haut",ADD_A_POINT_OF_INTEREST:"Ajouter un point d'intérêt",LATITUDE:"Latitude",LONGITUDE:"Longitude",NAME:"Nom",DESCRIPTION:"Description",BY_GPS:"Par coordonnées GPS",GIVING_A_LOCATION:"En donnant un lieu",PLEASE_PROVIDE_GPS_COORDINATES_TO_CENTER_THE_MAP:"Veuillez fournir des coordonnées GPS pour centrer la carte.",CHOOSE_CENTER:"Déterminer le centre",SELECT_A_TYPE:"Sélectionner un type",TYPE:"Type",ADD_A_NEW_TYPE:"Ajouter un nouveau type",ADD:"Ajouter",CANCEL:"Annuler",SAVE:"Sauvegarder",CHOOSE:"Choisir",OR:"ou",MUST_BE_A_NUMBER:"Doit être un nombre",PLEASE_PROVIDE_A_LATITUDE:"Veuillez fournir une latitude",PLEASE_PROVIDE_A_LONGITUDE:"Veuillez fournir une longitude",PLEASE_PROVIDE_A_NAME:"Veuillez fournir un nom",MAX_LATITUDE_IS_90:"La latitude maximum est 90",MIN_LATITUDE_IS_M90:"La latitude minimum est -90",MAX_LONGITUDE_IS_180:"La longitude maximum est 180",MIN_LONGITUDE_IS_M180:"La longitude minimum est 180",WHAT_DO_YOU_WANT_TO_DO:"Que souhaitez-vous faire ?",ADD_A_POI:"Ajouter un point d'intérêt",REPORT_A_BUG:"Signaler un bug",REPORT:"Signaler",PLEASE_DESCRIBE_THE_BUG_YOU_ENCOUNTERED:"Veuillez décrire le problème que vous avez rencontré.",YOU_MUST_DESCRIBE_THE_BUG:"Vous devez décrire votre bug pour le soumettre",BUG_REPORTED:"Bug reporté",POINTS_OF_INTEREST:"Points d'intérêt",POINT_OF_INTEREST_ADDED:"Point d'intérêt ajouté",UPLOAD_A_GPX_TRACE:"Uploader une trace GPX",UPLOAD:"Upload",GPX_FILE:"Fichier GPX",YOU_MUST_CHOOSE_A_FILE_TO_UPLOAD:"Vous devez choisir un fichier à uploader",THE_FIRST_STEP_IS_TO_DETERMINE_THE_CENTER_OF_THE_MAP:"La première étape est de choisir le centre de la carte.",LOCATION:"Lieu",PLEASE_PROVIDE_A_LOCATION:"Veuillez renseigner un lieu",PLEASE_START_TYPING_THE_NAME_OF_A_LOCATION_THEN_SELECT_IT:"Veuillez commencer à taper le nom d'un lieu puis le sélectionner.",SET_MAP_CENTER:"Définir le centre de la carte",BACK:"Retour",BUGS:"Bugs",PATHS:"Chemins",WELCOME:"Bienvenue",ACCESS_MAP:"Accéder à la carte",HOME:"Accueil",CLICK_ON_THE_MAP_TO_START:"Cliquez sur la carte pour commencer.",CLICK_ON_THE_MAP_TO_REVEAL_COORDINATE_ACTIONS:"Cliquez sur la carte pour afficher les actions liées.",BUG_LIST:"Liste de bugs",NO_BUG_REPORTED:"Aucun bug signalé",TYPE_A_LOCATION_NAME:"Entrez le nom d'un lieu",LOCK_POINTS_OF_INTEREST:"Verouiller les points d'intérêt",UNLOCK_POINTS_OF_INTEREST:"Déverouiller les points d'intérêt",RESOLVE:"Marquer comme résolu",UNSOLVED:"Non résolus",ALL:"Tous",RESOLVED:"Résolus",TRACE_LIST:"Liste de trace",NO_TRACE_REPORTED:"Aucune  trace signalée"}),angular.module("archCarto").constant("i18nenUSConstant",{CUSTOMER_NAME:"ArchCarto",CUSTOMER_DESC:"Trekking Routes Planner",MAIN_PAGE_HOME:"Home",MAIN_PAGE_ABOUTUS:"About Us",MAIN_PAGE_SERVICES:"Services",MAIN_PAGE_LOGIN:"Log In",MAIN_PAGE_LOGOUT:"Log Out",MAIN_PAGE_SIGNIN:"Sign In",MAIN_PAGE_MAP:"Map",ADD_A_POINT_OF_INTEREST:"Add a point of interest"}),angular.module("archCarto").factory("archSubscribeService",["$q",function(){return{init:function(){}}}]),angular.module("archCarto").directive("archSubscribe",["archSubscribeService","$mdToast","$mdDialog","$translate","leafletData","$window",function(){return{restrict:"E",templateUrl:"components/subscribe/arch-subscribe.html",controller:["$scope",function(){}]}}]),angular.module("archCarto").directive("archTip",["$timeout","$animate",function(e,t){return{restrict:"E",scope:{message:"@",duration:"=?"},templateUrl:"components/tip/arch-tip.html",link:function(a,n){n.addClass("arch-tip"),a.duration=a.duration||4e3,e(function(){t.leave(n)},a.duration)}}}]),angular.module("archCarto").factory("archSelectedCoordinatesService",["$q",function(e){var t={latitude:null,longitude:null};return{setSelectedCoordinates:function(a){var n=e.defer();return a.latitude?a.longitude?(t=a,n.resolve(a)):n.reject(new Error("Coordinates must have a longitude.")):n.reject(new Error("Coordinates must have a latitude.")),n.promise},getSelectedCoordinates:function(){var a=e.defer();return null==t.latitude||null==t.longitude?a.reject(new Error("Selected coordinates where not set.")):a.resolve(t),a.promise}}}]),angular.module("archCarto").factory("archRolesService",function(){var e={userIs:function(){return!0}};return e}),angular.module("archCarto").service("archPoiService",["archHttpService","$q","httpConstant",function(e,t,a){var n=a.apiUrl+"/map/poi";return{getPoiList:function(){return e.get(n)},savePoi:function(t){return e.post(n,t)}}}]),angular.module("archCarto").factory("archPoiTypeService",["$http","httpConstant","$q",function(e,t){var a=t.apiUrl+"/map/poi-type";return{getPoiTypeList:function(t){return e.get(a).success(t)},savePoiType:function(t,n){return e.post(a,t).success(n)}}}]),angular.module("archCarto").directive("archPoiForm",["archPoiService","archPoiTypeService","$filter",function(e,t,a){return{restrict:"E",scope:{poi:"=?",formValid:"="},templateUrl:"components/poi/arch-poi-form.html",link:function(e){e.formValid=!1,e.poi=e.poi||{},e.poiTypes=[],t.getPoiTypeList(function(t){e.poi.type=e.poi.type||t[0],e.poiTypes=t}),e.addPoiType=function(n){var r={name:n};t.savePoiType(r,function(t){e.poi.type=t,0==a("filter")(e.poiTypes,t.name,"strict").length&&e.poiTypes.push(t),e.newPoiTypeName=""})},e.$watch("poiForm.$valid",function(t){e.formValid=t?!0:!1},!0)}}}]),angular.module("archCarto").directive("archPoiDelete",["archPoiService",function(){return{restrict:"A",templateUrl:"components/poi/arch-poi-delete.html",scope:{poiId:"@"},link:function(e){e.deletePoi=function(){e.$emit("poiDeleted")}}}}]),angular.module("archCarto").directive("archPoiAdd",["archPoiService","$translate","$mdToast",function(e,t,a){return{restrict:"E",require:"^archMap",templateUrl:"components/poi/arch-poi-add.html",link:function(n,r,o,i){n.$watch("mapStatus.selectedCoordinates",function(e){n.poi=n.poi||{},n.poi.coordinates=e}),n.formValid=!1,n.savePoi=function(){e.savePoi(n.poi).then(function(){i.refreshMarkers(),t(["POINT_OF_INTEREST_ADDED"]).then(function(e){a.show(a.simple().content(e.POINT_OF_INTEREST_ADDED))}).then(n.closeRight)})}}}}]),angular.module("archCarto").directive("archMapSideNavPoiRight",["$mdSidenav",function(e){return{restrict:"E",require:"^archMap",templateUrl:"components/poi/arch-map-side-nav-poi-right.html",link:function(t){t.close=function(){e("rightSideNav").close()}}}}]),angular.module("archCarto").directive("archMapSideNavPoiLeft",["$mdSidenav","archMarkerService",function(e,t){return{restrict:"E",require:"^archMap",templateUrl:"components/poi/arch-map-side-nav-poi-left.html",link:function(e){e.addActions(["addPoi"]),e.poisDraggable=!1,e.togglePoisLock=function(){t.toggleMarkersLock("poi").then(function(t){e.poisDraggable=t})},e.savePois=function(){t.toggleMarkersLock("poi").then(function(t){e.poisDraggable=t})}}}}]),angular.module("archCarto").service("archPathService",["archMarkerService","$q",function(e,t){var a={enabled:!1,currentPath:{color:"red",weight:4,latlngs:[]},points:{}},n={type:"pog",icon:{type:"awesomeMarker",icon:"arrows-alt",markerColor:"red"}},r={type:"pop",icon:{type:"awesomeMarker",icon:"arrows-h",markerColor:"green"}};return{getPathDrawer:function(){return a},addPoint:function(o){var i=t.defer(),l=Object.keys(a.points).length;a.currentPath.latlngs.push({lat:o.latitude,lng:o.longitude});var c="pathDrawer_"+l,s={_id:c,coordinates:{latitude:o.latitude,longitude:o.longitude}};return 0===l?angular.extend(s,n):angular.extend(s,r),e.addEntity("pathDrawer",s).then(function(e){a.points[e._id]=e,i.resolve(e)}),i.promise},pathDrawn:function(){return a.currentPath.latlngs.length>0},deletePath:function(){var e=t.defer();a.currentPath.latlngs=[];var n=Object.keys(a.points);return a.points={},e.resolve(n),e.promise}}}]),angular.module("archCarto").directive("archMapSideNavPathLeft",["leafletData",function(){return{restrict:"E",require:"^archMap",templateUrl:"components/path/arch-map-side-nav-path-left.html",link:function(){}}}]),angular.module("archCarto").service("archMarkerService",["$http","$q","$log","httpConstant",function(e,t,a){var n={},r={},o={},i={},l=function(e){var a=t.defer();return e._id?e.coordinates?e.coordinates.latitude?e.coordinates.longitude||a.reject(new Error("Coordinates must have a longitude.")):a.reject(new Error("Coordinates must have a latitude.")):a.reject(new Error("An entity must have coordinates.")):a.reject(new Error("An entity must contain an _id property.")),a.resolve(e),a.promise},c=function(e,n){var i=t.defer();return l(n).then(function(t){var a="";t.name&&(a+="<h2>"+t.name+"</h2>"),t.description&&(a+="<div>"+t.description+"</div>");var l={_id:t._id,layer:e,lat:t.coordinates.latitude,lng:t.coordinates.longitude};a&&(l.message=a),n.icon?l.icon=n.icon:r[e]&&(l.icon=r[e]),o[e].push(t._id),i.resolve(l)}).catch(function(e){a.error(e)}),i.promise},s=function(e,r){var o=t.defer();return c(e,r).then(function(t){n[e][e+"_"+t._id]=t,o.resolve(t)}).catch(function(e){a.error("An error occured: "+e.message)}),o.promise};return{addMarkerType:function(e,a){var i=t.defer();return a=a||{},n[e]?i.reject(new Error("The marker type "+e+" already exists.")):(a.icon&&(r[e]=a.icon),n[e]={},o[e]=[],i.resolve()),i.promise},addEntities:function(e,a){for(var r=t.defer(),o=0;o<a.length;o+=1)s(e,a[o]).then(function(){o==a.length&&r.resolve(n[e])});return r.promise},addEntity:s,getMarkers:function(e){var a=t.defer();return a.resolve(n[e]),a.promise},toggleMarkersLock:function(e){var a=t.defer();if(angular.isDefined(n[e])){angular.isUndefined(i[e])&&(i[e]=!1),i[e]=!i[e];for(var r in n[e])n[e][r].draggable=i[e];a.resolve(i[e])}else a.reject(new Error("The given marker type "+e+" doesn't exist."));return a.promise},removeMarkers:function(e){var a=t.defer();return angular.isDefined(n[e])?(n[e]={},a.resolve(angular.isDefined(n[e]))):a.reject(new Error("The given marker type "+e+" doesn't exist.")),a.promise},popMarker:function(e){var a=t.defer();return angular.isDefined(n[e])||a.reject(new Error("The given marker type "+e+" doesn't exist.")),0==n[e].length?a.reject(new Error("The given marker type exists, but no markers where found.")):a.resolve(n[e].pop()),a.promise}}}]),angular.module("archCarto").factory("archMapService",["archPoiService","archMarkerService","archBugService","archLayerService","archGpxService","$q",function(e,t,a,n,r,o){return{init:function(){return o.all([n.addLayer("poi"),n.addLayer("bug"),n.addLayer("pathDrawer"),n.addLayer("selectedCoordinates")]).then(function(){return t.addMarkerType("poi",{icon:{type:"awesomeMarker",icon:"eye",markerColor:"blue"}}),t.addMarkerType("bug",{icon:{type:"awesomeMarker",icon:"exclamation-circle",markerColor:"orange"}}),t.addMarkerType("pathDrawer",{icon:{type:"awesomeMarker",markerColor:"red"}}),t.addMarkerType("selectedCoordinates",{icon:{type:"awesomeMarker",markerColor:"green"}}),n.getLayers()})},refreshMarkers:function(){var n=o.defer(),r={};return o.all([e.getPoiList(),a.getBugList({status:"unsolved"})]).then(function(e){for(var a=["poi","bug"],o=0;o<e.length;o+=1)t.addEntities(a[o],e[o]).then(function(t){angular.extend(r,t),o==e.length&&n.resolve(r)})}),n.promise}}}]),angular.module("archCarto").directive("archMap",["archMapService","archPoiService","archPathService","archBugService","archMarkerService","archGpxService","archMapDialogService","archLayerService","$mdToast","$mdDialog","$translate","leafletData","$window","$mdSidenav","archRolesService",function(e,t,a,n,r,o,i,l,c,s,d,m,u,p){return{restrict:"E",templateUrl:"components/map/arch-map.html",controller:["$scope",function(t){angular.extend(t,{center:{lat:49.08655299999999,lng:7.483997999999929,zoom:12},layers:{},markers:{},paths:{},controls:{draw:{},Elevation:{position:"topleft",theme:"steelblue-theme",width:600,height:125,margins:{top:10,right:20,bottom:30,left:50},collapsed:!0}}}),m.getMap().then(function(e){var a=t.controls.edit.featureGroup;e.on("draw:created",function(e){var t=e.layer;a.addLayer(t),console.log(JSON.stringify(t.toGeoJSON()))})}),t.cursor={lat:49.08655299999999,lng:7.483997999999929},t.mapStatus={selectedCoordinates:null,clicked:!1},t.actions={},m.getMap().then(function(e){e.addLayer(u.MQ.mapLayer());var t=L.tileLayer("//{s}.tile.thunderforest.com/landscape/{z}/{x}/{y}.png",{maxZoom:18});t.addTo(e),new L.GPX(gpx,{async:!0}).on("loaded",function(t){e.fitBounds(t.target.getBounds())}).addTo(e)}),/*archGpxService.getGpxUploader()
          .then(function(gpxUploader) {
            //$scope.gpxUploader = gpxUploader;
            //console.log("toto");
            //console.log(gpxUploader);
            //console.log("toto");

            leafletData.getMap('arch-map').then(function(map) {
              //premiere version
              //console.log("toto");
              //var el = L.control.elevation();
              //el.addTo(map);
              //var g = new L.GPX(
              //  gpxUploader, {
              //    async: true
              //  }
              //).on('loaded',
              //  function(e) {
              //    map.fitBounds(e.target.getBounds());
              //  }
              //).addTo(map);
              //g.on("addline",function(e){
              //  el.addData(e.line);
              //});
              //g.addTo(map);

              //deuxieme version
              //
              //var url = 'http://otile{s}.mqcdn.com/tiles/1.0.0/map/{z}/{x}/{y}.jpeg',
              //  attr ='Tiles Courtesy of <a href="http://www.mapquest.com/">MapQuest</a> &mdash; Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>',
              //  service = new L.TileLayer(url, {subdomains:"1234",attribution: attr});





              var el = L.control.elevation({
                position: "topleft",
                theme: "steelblue-theme",
                width: 600,
                height: 125,
                margins: {
                  top: 10,
                  right: 20,
                  bottom: 30,
                  left: 50
                },
                collapsed: true

              });
              el.addTo(map);

              var g=new L.GPX(gpxUploader, {
                async: true
              });
              g.on('loaded', function(e) {
                map.fitBounds(e.target.getBounds());
              });
              g.on("addline",function(e){
                el.addData(e.line);
              });
              g.addTo(map);

              //map.addLayer(service);
            });
          });*/
this.getMap=function(){return m.getMap()},this.setCenter=function(e){t.center.lat=e.latitude,t.center.lng=e.longitude},this.displayGeoJson=function(e){this.getMap().then(function(t){L.geoJson(e).addTo(t)})},this.displayElevation=function(e){this.getMap().then(function(t){var a=L.control.elevation({position:"topright",theme:"steelblue-theme",width:600,height:125,margins:{top:10,right:20,bottom:30,left:50},useHeightIndicator:!0,interpolation:"linear",hoverNumber:{decimalsX:3,decimalsY:0,formatter:void 0},xTicks:void 0,yTicks:void 0,collapsed:!1});a.addTo(t);var n=L.geoJson(e,{onEachFeature:a.addData.bind(a)}).addTo(t);t.fitBounds(n.getBounds())})};var a=!1;t.addActions=function(e){for(var a=0;a<e.length;a+=1)t.actions[e[a]]=!1},t.setAction=function(e){for(var a in t.actions)t.actions[a]=!1;if(angular.isDefined(t.actions[e])){t.actions[e]?t.toggleRight():n?t.closeRight():t.openRight(),t.actions[e]=!0;var n=!0}else{t.closeRight();var n=!1}},t.hasAction=function(){return a};var n=this.refreshMarkers=function(){e.refreshMarkers().then(function(e){angular.extend(t.markers,e)})};t.$on("leafletDirectiveMap.load",function(){n()}),t.openLeft=function(){p("leftSideNav").open()},t.openRight=function(){p("rightSideNav").open()},t.closeLeft=function(){p("leftSideNav").close()},t.closeRight=function(){p("rightSideNav").close()},t.toggleRight=function(){p("rightSideNav").toggle()},t.toggleLeft=function(){p("leftSideNav").toggle()}}],link:function(t){e.init().then(function(e){angular.extend(t.layers,e);var n=t.pathDrawer=a.getPathDrawer(),o=t.refreshMarkers;t.pathDrawn=function(){return a.pathDrawn()},t.disablePathDrawer=function(){n.enabled=!1,l.showLayers(["poi","bug"]),l.hideLayers(["pathDrawer"]),d(["PATH_DRAWER_QUIT"]).then(function(e){c.show(c.simple().content(e.PATH_DRAWER_QUIT))})},t.deletePath=function(){a.deletePath().then(function(e){e.forEach(function(e){delete t.markers[e]})})},t.$on("leafletDirectiveMap.moveend",o),t.$on("leafletDirectiveMap.mousemove",function(e,a){var n=a.leafletEvent,r=n.latlng;t.cursor.lat=r.lat,t.cursor.lng=r.lng}),t.$on("leafletDirectiveMap.click",function(e,a){t.mapStatus.selectedCoordinates={latitude:a.leafletEvent.latlng.lat,longitude:a.leafletEvent.latlng.lng},t.mapStatus.clicked=!0,r.removeMarkers("selectedCoordinates").then(function(){r.addEntity("selectedCoordinates",{_id:"-1",coordinates:t.mapStatus.selectedCoordinates})})})})}}}]),angular.module("archCarto").directive("archMapSideNavLeft",["$mdSidenav",function(){return{restrict:"E",scope:{mapStatus:"="},templateUrl:"components/map/arch-map-side-nav-left.html",link:function(){}}}]),angular.module("archCarto").factory("archMapDialogService",["$mdDialog","archHttpService","$q","$timeout",function(e,t){return{showCenterDialog:function(a){return e.show({templateUrl:"components/map/arch-map-center-dialog.html",controller:["$scope",function(n){n.center={},n.location={},n.selectedTab=0,a&&(n.center.latitude=a.latitude,n.center.longitude=a.longitude),n.getMatchLocations=function(e){return t.get("http://open.mapquestapi.com/nominatim/v1/search.php",{params:{format:"json",q:e,limit:5}})},n.cancel=function(){e.cancel()},n.extractCenter=function(e){n.center.latitude=parseFloat(e.lat),n.center.longitude=parseFloat(e.lon)},n.chooseCenter=function(t){e.hide(t)},n.hasCenter=function(){return n.center&&n.center.latitude&&n.center.longitude}}]})},showActionDialog:function(){return e.show({templateUrl:"components/map/arch-map-action-dialog.html",controller:["$scope",function(t){t.selectAction=function(t){e.hide(t)},t.cancel=function(){e.cancel()}}]})},showPoiDialog:function(t){return e.show({templateUrl:"components/map/arch-map-poi-dialog.html",controller:["$scope",function(a){a.poi={coordinates:t},a.formValid=!1,a.cancel=function(){e.cancel()},a.savePoi=function(t){e.hide(t)}}]})},showBugDialog:function(t){return e.show({templateUrl:"components/map/arch-map-bug-dialog.html",controller:["$scope",function(a){a.bug={coordinates:t},a.cancel=function(){e.cancel()},a.reportBug=function(t){e.hide(t)}}]})},showGpxDialog:function(){return e.show({templateUrl:"components/map/arch-map-gpx-dialog.html",controller:["$scope",function(){}]})}}}]),angular.module("archCarto").factory("archLoginService",["archHttpService","$q","httpConstant",function(e,t,a){var n=a.casUrl+"/oauth/oauth";return{saveClient:function(){var r={name:a.clientName,redirect_uri:a.clientRedirectUri},o=t.defer();return e.post(n+"/client",r).then(function(e){o.resolve(e)}).catch(function(e){o.reject(e.message)}),o.promise}}}]),angular.module("archCarto").directive("archLogin",["archLoginService","$translate","$window","httpConstant",function(e,t,a,n){return{restrict:"E",templateUrl:"components/login/arch-login.html",controller:["$scope","$cookieStore","$base64",function(t,a,r){function o(e){var t=new Date;return t.getTime()>e.expired_at?(a.remove("token"),!0):!1}!function(){var i=a.get("token");if(!i||o(i)){t.alreadyLogged=!1,console.log("INIT : Not connected");var l=a.get("clientId")||"",c=a.get("clientSecret")||"",s=a.get("clientRedirectUri")||"",d=a.get("clientHash")||"";0==l.length||0==c.length||0==s.length||0==d.length?(console.log("INIT : Params not found in cookies, save new client."),e.saveClient().then(function(e){console.log("INIT : Params saved in cookies.");var o=r.encode(e.data.clientId+":"+e.data.clientSecret);a.put("clientId",e.data.clientId),a.put("clientSecret",e.data.clientSecret),a.put("clientRedirectUri",e.data.clientRedirectUri),a.put("clientHash",o),t.loginUrl=n.loginUrl+"/#/?client="+o+"&return="+r.encode(e.data.clientRedirectUri)})):(console.log("INIT : Params found in cookies."),t.loginUrl=n.loginUrl+"/#/?client="+d+"&return="+r.encode(s))}else console.log("INIT : Already connected."),t.alreadyLogged=!0,t.mapUrl="/#/map",t.username=i.user.fname+" "+i.user.lname}();t.logout=function(){confirm("Souhaitez-vous réellement vous déconnecter ?")&&(a.remove("token"),window.location.reload())}}]}}]),angular.module("archCarto").factory("archHttpService",["$http","$q",function(e,t){return{get:function(a,n){var r=t.defer();return n=n||{},e.get(a,n).success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise},post:function(a,n,r){var o=t.defer();return r=r||{},e.post(a,n,r).success(function(e){o.resolve(e)}).error(function(e){o.reject(e)}),o.promise},"delete":function(a,n){var r=t.defer();return n=n||{},e.delete(a,n).success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise}}}]),angular.module("archCarto").service("archLayerService",["$http","$q","$log","httpConstant",function(e,t){var a={overlays:{}},n=function(e,t){for(var n in a){var r=a[n];for(var o in e){var i=e[o],l=r[i];l&&(l.visible="hide"===t?!1:!0)}}};return{addLayer:function(e,n){var r=t.defer();n=n||{};var o=n.type||"overlays";return a[o][e]?r.reject(new Error("Layer already exists")):(a[o][e]={type:"group",name:e,visible:n.visible||!0},r.resolve(a[o][e])),r},getLayers:function(){return a},hideLayers:function(e){n(e,"hide")},showLayers:function(e){n(e)},setActiveLayers:function(){n([])}}}]),angular.module("archCarto").factory("archGpxUploadService",["archHttpService","$q","httpConstant",function(e,t,a){var n=a.apiUrl+"/map/gpx";return{uploadFileToUrl:function(t){var a=t[0],r=new FormData;return r.append("file",a),e.post(n,r,{headers:{"Content-Type":void 0},transformRequest:angular.identity})}}}]),angular.module("archCarto").directive("archGpxUploadForm",["$parse",function(){return{restrict:"E",scope:{poi:"=?",formValid:"="},templateUrl:"components/gpx/arch-upload-form.html",controller:["$scope","httpConstant","FileUploader","archGpxUploadService","archHttpService",function(e,t,a){var n=t.apiUrl+"/map/gpx/";e.uploader=new a({removeAfterUpload:!0,autoUpload:!1,queueLimit:1}),e.upload=function(){e.uploader.uploadAll()},e.uploader.onBeforeUploadItem=function(t){e.uploadError=null,t.url=n},e.uploader.onAfterAddingFile=function(){e.uploadError=null},e.uploader.onErrorItem=function(t){e.uploadError="Error when uploading the file "+t.file.name+"."},e.uploader.onSuccessItem=function(){},e.isUploading=function(){return!_.isEmpty(e.uploader.queue)}}],link:function(){}}}]),angular.module("archCarto").directive("archMapTraceList",["archGpxService","$mdToast","$translate","leafletData",function(e){return{restrict:"E",require:"^archMap",templateUrl:"components/gpx/arch-map-trace-list.html",controller:["$scope",function(t){e.getTrace().then(function(e){t.traces=e})}],link:function(e,t,a,n){e.displayTrace=function(e){n.displayElevation(e)}}}}]),angular.module("archCarto").factory("archGpxService",["$http","httpConstant","$q","FileUploader","archHttpService",function(e,t,a,n,r){var o=t.apiUrl+"/map/gpx";return{getTrace:function(e){return r.get(o,{params:e})}}}]),angular.module("archCarto").directive("archMapSideNavCenterRight",["$stateParams","$mdSidenav",function(){return{restrict:"E",templateUrl:"components/center/arch-map-side-nav-center-right.html",link:function(){}}}]),angular.module("archCarto").directive("archMapSideNavCenterLeft",["$mdSidenav",function(){return{restrict:"E",templateUrl:"components/center/arch-map-side-nav-center-left.html",link:function(e){e.addActions(["gps","location"])}}}]),angular.module("archCarto").directive("archMapCenterSearch",["archHttpService",function(e){return{restrict:"E",require:"^archMap",templateUrl:"components/center/arch-map-center-search.html",link:function(t,a,n,r){t.chooseCenter=function(e){r.setCenter(e),t.closeRight()},t.extractCenter=function(e){angular.isDefined(e)&&(t.center.latitude=parseFloat(e.lat),t.center.longitude=parseFloat(e.lon)),t.chooseCenter(t.center)},t.getMatchLocations=function(t){return e.get("http://open.mapquestapi.com/nominatim/v1/search.php",{params:{format:"json",q:t,limit:5}})}}}}]),angular.module("archCarto").directive("archMapCenterLocation",["archHttpService",function(e){return{restrict:"E",require:"^archMap",templateUrl:"components/center/arch-map-center-location.html",link:function(t,a,n,r){t.chooseCenter=function(e){r.setCenter(e),t.closeRight()},t.extractCenter=function(e){angular.isDefined(e)&&(t.center.latitude=parseFloat(e.lat),t.center.longitude=parseFloat(e.lon))},t.getMatchLocations=function(t){return e.get("http://open.mapquestapi.com/nominatim/v1/search.php",{params:{format:"json",q:t,limit:5}})}}}}]),angular.module("archCarto").directive("archMapCenterGps",function(){return{restrict:"E",require:"^archMap",templateUrl:"components/center/arch-map-center-gps.html",link:function(e,t,a,n){e.chooseCenter=function(t){n.setCenter(t),e.closeRight()}}}}),angular.module("archCarto").directive("archMapSideNavBugRight",function(){return{restrict:"E",templateUrl:"components/bug/arch-map-side-nav-bug-right.html"}}),angular.module("archCarto").directive("archMapSideNavBugLeft",[function(){return{restrict:"E",templateUrl:"components/bug/arch-map-side-nav-bug-left.html",link:function(e){e.addActions(["report","list"])}}}]),angular.module("archCarto").directive("archMapBugReport",["$translate","$mdToast","archBugService",function(e,t,a){return{restrict:"E",require:"^archMap",templateUrl:"components/bug/arch-map-bug-report.html",link:function(n,r,o,i){n.bug={coordinates:n.mapStatus.selectedCoordinates,status:"unsolved"},n.reportBug=function(r){a.saveBug(r).then(function(){i.refreshMarkers(),e(["BUG_REPORTED"]).then(function(e){t.show(t.simple().content(e.BUG_REPORTED)),n.closeRight()})})}}}}]),angular.module("archCarto").directive("archMapBugList",["archBugService","$mdToast","$translate",function(e,t,a){return{restrict:"E",require:"^archMap",templateUrl:"components/bug/arch-map-bug-list.html",controller:["$scope",function(t){e.getBugList().then(function(e){t.bugs=e})}],link:function(n,r,o,i){n.filterOptions={status:"resolved"},n.setFilter=function(e){n.filterOptions.status=e?e:""},n.centerOnBug=function(e){i.setCenter(e.coordinates)},n.resolve=function(n){n.status="resolved",e.saveBug(n).then(function(){a(["BUG_MARKED_AS_RESOLVED"]).then(function(e){t.show(t.simple().content(e.BUG_MARKED_AS_RESOLVED))})}).then(i.refreshMarkers())}}}}]),angular.module("archCarto").service("archBugService",["archHttpService","$q","httpConstant",function(e,t,a){var n=a.apiUrl+"/map/bug";return{getBugList:function(t){return e.get(n,{params:t})},saveBug:function(t){return e.post(n,t)}}}]),angular.module("archCarto").directive("archRotate",function(){return{restrict:"A",link:function(e,t,a){a.$observe("archRotate",function(e){if(e=e||0,angular.isDefined(e)){var a="rotate("+e+"deg)";t.css({"-webkit-transform":a})}})}}}),angular.module("archCarto").directive("archContentDropdown",function(){return{restrict:"E",transclude:!0,scope:{title:"=",splitTitle:"@",splitFn:"&",showSplit:"="},templateUrl:"app/utils/arch-content-dropdown.html",link:function(e,t){t.find(".arch-drop-icon");e.showSplit=!0,e.rotationAngle=0,e.dropped=!1,e.dropdown=function(){e.dropped=!e.dropped,e.rotationAngle+=180}}}}),angular.module("archCarto").directive("archBackButton",["$document",function(e){return{restrict:"E",scope:{backState:"@",backText:"@"},templateUrl:"app/utils/arch-back-button.html",controller:["$scope",function(t){t.backState=t.backState||"",t.backText=t.backText||"BACK",t.clearBackdrop=function(){e.find("body").find(".md-sidenav-backdrop").remove()}}]}}]),angular.module("archCarto").directive("archSideNav",function(){return{restrict:"E",transclude:!0,templateUrl:"app/side-nav/arch-side-nav.html",link:function(e,t,a){e.title=a.title}}}),angular.module("archCarto").directive("archSection",["$window",function(e){return{restrict:"E",link:function(t,a){var n=angular.element(e);n.on("resize",function(){a.css("height","100%")})}}}]),angular.module("archCarto").directive("archParallax",["$window",function(e){return{restrict:"A",link:function(t,a,n){var r=angular.element(e),o=parseInt(n.archParallax,10)||4,i=function(){var e=-(r.scrollTop()/o),t="50% "+e+"px";a.css({backgroundPosition:t})};i(),r.on("scroll",i)}}}]),angular.module("archCarto").constant("httpConstant",{apiUrl:"http://localhost:3022",loginUrl:"http://localhost:3010",casUrl:"http://localhost:3021",clientName:"ARCH-CARTO",clientRedirectUri:"http://localhost:3012/#/map"}),angular.module("archCarto").run(["$templateCache",function(e){e.put("app/main/main.html",'<md-toolbar class="md-default-theme" id="toolbar" style="position:fixed;top:0;"><div class="md-toolbar-tools"><a href="/"><b>{{\'CUSTOMER_NAME\' | translate}}</b> - {{\'CUSTOMER_DESC\' | translate}}</a> <span flex=""></span><ul class="main-menu"><li><md-button class="md-button" ui-sref="map.home">{{\'ACCESS_MAP\' | translate}}</md-button></li><li><arch-login></arch-login></li></ul></div></md-toolbar><section id="aboutus" class="arch-section arch-section-full-width" style="background:url(../../assets/images/rev-slider1.jpg);" arch-parallax="4" layout="column" fill-layout="" layout-align="center center"><md-card style="background: rgba(255,255,255,0.7);"><md-card-content><h2>Bienvenue sur Arch Map</h2><p>Arch Map vous permet de planifier vos itinéraires de randonnées.</p></md-card-content></md-card></section>'),e.put("app/side-nav/arch-side-nav.html",'<md-toolbar class="md-theme-indigo"><h1 class="md-toolbar-tools">{{\'BUGS\' | translate}}</h1></md-toolbar><md-content><ng-transclude></ng-transclude></md-content>'),e.put("app/utils/arch-back-button.html",'<md-button ui-sref="{{::backState}}" ng-click="clearBackdrop()" layout-fill=""><span class="fa fa-chevron-left"></span> {{::backText | translate}}</md-button>'),e.put("app/utils/arch-content-dropdown.html",'<span layout="row"><md-button class="md-primary arch-content-dropdow-button" ng-click="dropdown()" flex=""><span flex="">{{title}}</span> <span class="fa fa-angle-down arch-drop-icon" arch-rotate="{{rotationAngle}}"></span></md-button><md-button class="arch-content-dropdow-split-button" ng-click="splitFn()" flex="" ng-if="showSplit">{{splitTitle}}</md-button></span><md-content class="md-padding" ng-if="dropped"><ng-transclude></ng-transclude></md-content>'),e.put("components/gpx/arch-map-trace-list.html",'<md-toolbar><h1 class="md-toolbar-tools">{{\'TRACE_LIST\' | translate}}</h1></md-toolbar><md-content class="md-padding"><span ng-if="!traces">{{\'NO_TRACE_REPORTED\' | translate}}</span> <span ng-if="traces"><md-content class="md-padding"><arch-content-dropdown ng-repeat="trace in traces | filter:filterOptions" title="trace.features[0].properties.name" ng-click="displayTrace(trace)"><p>{{\'TYPE\' | translate}}: {{trace.features[0].geometry.type}}</p></arch-content-dropdown></md-content></span></md-content>'),e.put("components/gpx/arch-upload-form.html",'<md-toolbar class="md-theme-indigo"><h1 class="md-toolbar-tools">{{\'POINTS_OF_INTEREST\' | translate}}</h1></md-toolbar><md-content class="md-theme-default" layout="column"><arch-back-button back-state="map.home" layout-fill=""></arch-back-button><md-content class="md-theme-default md-padding"><div><form class="form-horizontal" name="uploadForm" role="form" enctype="multipart/form-data" novalidate=""><div style="text-align:center"><field label="Schema File"><input type="file" nv-file-select="" class="btn btn-group btn-input clearfix" uploader="uploader"></field></div><div class="alert alert-danger" ng-show="uploadError!=null">{{uploadError}}</div><div class="col-xs-12"><md-button class="md-primary" ng-click="cancel()">Cancel</md-button><md-button class="md-primary" ng-click="upload()" ng-disabled="uploadForm.$invalid">Upload</md-button></div></form></div></md-content><arch-map-trace-list></arch-map-trace-list></md-content>'),e.put("components/bug/arch-map-bug-list.html",'<md-toolbar><h1 class="md-toolbar-tools">{{\'BUG_LIST\' | translate}}</h1></md-toolbar><md-content class="md-padding"><span ng-if="!bugs">{{\'NO_BUG_REPORTED\' | translate}}</span> <span ng-if="bugs"><md-tabs><md-tab md-on-select="setFilter()">{{\'ALL\' | translate}}</md-tab><md-tab md-on-select="setFilter(\'unsolved\')">{{\'UNSOLVED\' | translate}}</md-tab><md-tab md-on-select="setFilter(\'resolved\')">{{\'RESOLVED\' | translate}}</md-tab></md-tabs></span><md-content class="md-padding"><arch-content-dropdown ng-repeat="bug in bugs | filter:filterOptions" title="::bug.description" split-title="{{\'RESOLVE\' | translate}}" split-fn="resolve(bug)" show-split="bug.status == \'unsolved\'" ng-click="centerOnBug(bug)"><p>{{\'LATITUDE\' | translate}}: {{bug.coordinates.latitude}}</p><p>{{\'LONGITUDE\' | translate}}: {{bug.coordinates.longitude}}</p><md-divider></md-divider><p>{{\'DESCRIPTION\' | translate}}: {{bug.description}}</p></arch-content-dropdown></md-content></md-content>'),e.put("components/bug/arch-map-bug-report.html",'<md-toolbar><h1 class="md-toolbar-tools">{{\'REPORT_A_BUG\' | translate}}</h1></md-toolbar><md-content class="md-padding"><div layout="" layout-sm="column"><md-input-container flex=""><label>{{\'LATITUDE\' | translate}}</label> <input type="text" ng-model="bug.coordinates.latitude" ng-disabled="true"></md-input-container><md-input-container flex=""><label>{{\'LONGITUDE\' | translate}}</label> <input type="text" ng-model="bug.coordinates.longitude" ng-disabled="true"></md-input-container></div><ng-form name="bugForm"><p>{{\'PLEASE_DESCRIBE_THE_BUG_YOU_ENCOUNTERED\' | translate}}</p><md-input-container><label>{{\'DESCRIPTION\' | translate}}</label> <textarea ng-model="bug.description" name="description" required=""></textarea><div ng-messages="bugForm.description.$error" ng-if="bugForm.description.$dirty"><span ng-message="required">{{\'YOU_MUST_DESCRIBE_THE_BUG\' | translate}}</span></div></md-input-container></ng-form><md-button ng-click="closeRight()">{{\'CANCEL\' | translate}}</md-button><md-button ng-click="reportBug(bug)" class="md-primary" ng-disabled="bugForm.$invalid">{{\'REPORT\' | translate}}</md-button></md-content>'),e.put("components/bug/arch-map-side-nav-bug-left.html",'<md-sidenav class="md-sidenav-left arch-side-nav" md-component-id="leftSideNav" md-is-locked-open="true" layout="column"><md-toolbar class="md-theme-indigo"><h1 class="md-toolbar-tools">{{\'BUGS\' | translate}}</h1></md-toolbar><md-content><arch-back-button back-state="map.home"></arch-back-button><md-content class="md-padding" ng-if="!mapStatus.selectedCoordinates">{{\'CLICK_ON_THE_MAP_TO_REVEAL_COORDINATE_ACTIONS\' | translate}}</md-content><div ng-if="mapStatus.selectedCoordinates"><md-button class="md-primary" ng-click="setAction(\'report\')" layout-fill="">{{\'REPORT_A_BUG\' | translate}}</md-button></div><md-button class="md-primary" ng-click="setAction(\'list\')" layout-fill="">{{\'BUG_LIST\' | translate}}</md-button></md-content></md-sidenav>'),e.put("components/bug/arch-map-side-nav-bug-right.html",'<arch-map-bug-report ng-if="actions.report"></arch-map-bug-report><arch-map-bug-list ng-if="actions.list"></arch-map-bug-list>'),e.put("components/login/arch-login.html",'<div ng-if="!alreadyLogged"><md-button class="md-button" href="{{loginUrl}}">{{\'MAIN_PAGE_LOGIN\' | translate}}</md-button><md-button class="md-button">{{\'MAIN_PAGE_SIGNIN\' | translate}}</md-button></div><div ng-if="alreadyLogged"><md-button class="md-button" href="{{mapUrl}}">{{username}}</md-button><md-button class="md-button" ng-click="logout()">{{\'MAIN_PAGE_LOGOUT\' | translate}}</md-button></div>'),e.put("components/map/arch-map-action-dialog.html",'<md-dialog><md-content><md-subheader class="md-sticky-no-effect">{{\'WHAT_DO_YOU_WANT_TO_DO\' | translate}}</md-subheader><div><md-button class="md-primary" ng-click="selectAction(\'poi\')">{{\'ADD_A_POINT_OF_INTEREST\' | translate}}</md-button></div><div><md-button class="md-primary" ng-click="selectAction(\'bug\')">{{\'REPORT_A_BUG\' | translate}}</md-button></div><div><md-button class="md-primary" ng-click="selectAction(\'gpx\')">{{\'UPLOAD_A_GPX_TRACE\' | translate}}</md-button></div><div><md-button class="md-primary" ng-click="selectAction(\'center\')">{{\'SET_MAP_CENTER\' | translate}}</md-button></div><div><md-button class="md-primary" ng-click="selectAction(\'path\')">{{\'DRAW_A_PATH\' | translate}}</md-button></div></md-content><div class="md-actions" layout="row"><md-button ng-click="cancel()">{{\'CANCEL\' | translate}}</md-button></div></md-dialog>'),e.put("components/map/arch-map-bug-dialog.html",'<md-dialog><md-content><md-subheader class="md-sticky-no-effect">{{\'REPORT_A_BUG\' | translate}}</md-subheader><div layout="" layout-sm="column"><md-input-container flex=""><label>{{\'LATITUDE\' | translate}}</label> <input type="text" ng-model="bug.coordinates.latitude" ng-disabled="true"></md-input-container><md-input-container flex=""><label>{{\'LONGITUDE\' | translate}}</label> <input type="text" ng-model="bug.coordinates.longitude" ng-disabled="true"></md-input-container></div><ng-form name="bugForm"><p>{{\'PLEASE_DESCRIBE_THE_BUG_YOU_ENCOUNTERED\' | translate}}</p><md-input-container><label>{{\'DESCRIPTION\' | translate}}</label> <textarea ng-model="bug.description" name="description" required=""></textarea><div ng-messages="bugForm.description.$error" ng-if="bugForm.description.$dirty"><span ng-message="required">{{\'YOU_MUST_DESCRIBE_THE_BUG\' | translate}}</span></div></md-input-container></ng-form></md-content><div class="md-actions" layout="row"><md-button ng-click="cancel()">{{\'CANCEL\' | translate}}</md-button><md-button ng-click="reportBug(bug)" class="md-primary" ng-disabled="bugForm.$invalid">{{\'REPORT\' | translate}}</md-button></div></md-dialog>'),e.put("components/map/arch-map-center-dialog.html",'<md-dialog style="width: 500px"><md-content><md-subheader class="md-sticky-no-effect">{{\'CHOOSE_CENTER\' | translate}}</md-subheader><p>{{\'THE_FIRST_STEP_IS_TO_DETERMINE_THE_CENTER_OF_THE_MAP\' | translate}}</p><md-tabs md-selected="selectedTab"><md-tab>{{\'BY_GPS\' | translate}}</md-tab><md-tab>{{\'GIVING_A_LOCATION\' | translate}}</md-tab></md-tabs><div style="min-height: 300px"><ng-form name="chooseCenterForm"><ng-switch on="selectedTab" class="tabpanel-container"><div ng-switch-when="0"><p>{{\'PLEASE_PROVIDE_GPS_COORDINATES_TO_CENTER_THE_MAP\' | translate}}</p><div layout="column"><md-input-container flex=""><label>{{\'LATITUDE\' | translate}}</label> <input type="number" ng-model="center.latitude" name="latitude" min="-90" max="90" required=""><div ng-messages="chooseCenterForm.latitude.$error" ng-if="chooseCenterForm.latitude.$dirty"><div ng-message="number">{{\'MUST_BE_A_NUMBER\' | translate}}</div><div ng-message="required">{{\'PLEASE_PROVIDE_A_LATITUDE\' | translate}}</div><div ng-message="max">{{\'MAX_LATITUDE_IS_90\' | translate}}</div><div ng-message="mix">{{\'MIN_LATITUDE_IS_M90\' | translate}}</div></div></md-input-container><md-input-container flex=""><label>{{\'LONGITUDE\' | translate}}</label> <input type="number" ng-model="center.longitude" name="longitude" min="-180" max="180" required=""><div ng-messages="chooseCenterForm.longitude.$error" ng-if="chooseCenterForm.longitude.$dirty"><div ng-message="number">{{\'MUST_BE_A_NUMBER\' | translate}}</div><div ng-message="required">{{\'PLEASE_PROVIDE_A_LONGITUDE\' | translate}}</div><div ng-message="max">{{\'MAX_LONGITUDE_IS_180\' | translate}}</div><div ng-message="mix">{{\'MIN_LONGITUDE_IS_M180\' | translate}}</div></div></md-input-container></div></div><div ng-switch-when="1"><p>{{\'PLEASE_START_TYPING_THE_NAME_OF_A_LOCATION_THEN_SELECT_IT\' | translate}}</p><div layout="" layout-sm="column"><md-autocomplete md-selected-item="location.selected" md-search-text="location.search" md-items="item in getMatchLocations(location.search)" md-item-text="item.display_name" md-selected-item-change="extractCenter(item)" md-delay="2000" flex=""><span md-highlight-text="location.search">{{item.display_name}}</span></md-autocomplete><div ng-messages="chooseCenterForm.location.$error" ng-if="chooseCenterForm.location.$dirty"><div ng-message="required">{{\'PLEASE_PROVIDE_A_LOCATION\' | translate}}</div></div></div></div></ng-switch></ng-form></div></md-content><div class="md-actions" layout="row"><md-button ng-click="cancel()">{{\'CANCEL\' | translate}}</md-button><md-button ng-click="chooseCenter(center)" class="md-primary" ng-disabled="chooseCenterForm.$invalid || !hasCenter()">{{\'CHOOSE\' | translate}}</md-button></div></md-dialog>'),e.put("components/map/arch-map-gpx-dialog.html",'<md-dialog style="width: 800px;"><md-content><md-subheader class="md-sticky-no-effect">{{\'UPLOAD_A_GPX_TRACE\' | translate}}</md-subheader><arch-gpx-upload-form></arch-gpx-upload-form></md-content></md-dialog>'),e.put("components/map/arch-map-poi-dialog.html",'<md-dialog style="width: 800px;"><md-content><md-subheader class="md-sticky-no-effect">{{\'ADD_A_POINT_OF_INTEREST\' | translate}}</md-subheader><arch-poi-form poi="poi" form-valid="formValid"></arch-poi-form><div class="md-actions" layout="row"><md-button ng-click="cancel()">{{\'CANCEL\' | translate}}</md-button><md-button ng-click="savePoi(poi)" class="md-primary" ng-disabled="!formValid">{{\'ADD\' | translate}}</md-button></div></md-content></md-dialog>'),e.put("components/map/arch-map-side-nav-left.html",'<md-toolbar class="md-theme-indigo"><h1 class="md-toolbar-tools">{{\'WELCOME\' | translate}}</h1></md-toolbar><md-content layout="column"><arch-back-button back-state="main" back-text="HOME"></arch-back-button><md-button class="md-primary" ui-sref="map.poi"><span class="fa fa-heart"></span> {{\'POINTS_OF_INTEREST\' | translate}}</md-button><md-button class="md-primary" ui-sref="map.bug"><span class="fa fa-bug"></span> {{\'BUGS\' | translate}}</md-button><md-button class="md-primary" ui-sref="map.path"><span class="fa fa-location-arrow"></span> {{\'PATHS\' | translate}}</md-button><md-button class="md-primary" ui-sref="map.gpx"><span class="fa fa-upload"></span> {{\'UPLOAD_A_GPX_TRACE\' | translate}}</md-button></md-content>'),e.put("components/map/arch-map.html",'<section layout="row" flex=""><md-sidenav class="md-sidenav-left arch-side-nav md-whiteframe-z2" md-component-id="leftSideNav" md-is-locked-open="true" layout="column" ui-view="sideNavLeft"></md-sidenav><div layout="column" flex=""><md-toolbar class="background-transition" md-theme="{{currentTheme}}" md-theme-watch=""><div class="md-toolbar-tools"><div layout="row" flex="" class="fill-height"><div class="md-toolbar-tools"><span layout="row" layout-align="begin center" flex=""><arch-map-center-search flex=""></arch-map-center-search><div class="smaller" flex=""><div layout="row" layout-align="center center" class="arch-text-center"><span class="padded" flex="">{{\'LATITUDE\' | translate}}: {{cursor.lat | number: 6}}</span> <span class="padded" flex="">{{\'LONGITUDE\' | translate}}: {{cursor.lng | number: 6}}</span></div></div></span></div></div></div></md-toolbar><div leaflet="" center="center" markers="markers" layers="layers" paths="paths" controls="controls" ng-class="{\'is-drawing-path\': pathDrawer.enabled}" layout="column" flex=""></div></div><md-sidenav class="md-sidenav-right arch-side-nav-right arch-side-nav-large" md-component-id="rightSideNav" ui-view="sideNavRight"></md-sidenav></section>'),e.put("components/center/arch-map-center-gps.html",'<md-toolbar><h1 class="md-toolbar-tools">{{\'BY_GPS\' | translate}}</h1></md-toolbar><md-content class="md-padding"><p>{{\'PLEASE_PROVIDE_GPS_COORDINATES_TO_CENTER_THE_MAP\' | translate}}</p><ng-form name="chooseCenterForm"><div layout="column"><md-input-container flex=""><label>{{\'LATITUDE\' | translate}}</label> <input type="number" ng-model="center.lat" name="latitude" min="-90" max="90" required=""><div ng-messages="chooseCenterForm.latitude.$error" ng-if="chooseCenterForm.latitude.$dirty"><div ng-message="number">{{\'MUST_BE_A_NUMBER\' | translate}}</div><div ng-message="required">{{\'PLEASE_PROVIDE_A_LATITUDE\' | translate}}</div><div ng-message="max">{{\'MAX_LATITUDE_IS_90\' | translate}}</div><div ng-message="mix">{{\'MIN_LATITUDE_IS_M90\' | translate}}</div></div></md-input-container><md-input-container flex=""><label>{{\'LONGITUDE\' | translate}}</label> <input type="number" ng-model="center.lng" name="longitude" min="-180" max="180" required=""><div ng-messages="chooseCenterForm.longitude.$error" ng-if="chooseCenterForm.longitude.$dirty"><div ng-message="number">{{\'MUST_BE_A_NUMBER\' | translate}}</div><div ng-message="required">{{\'PLEASE_PROVIDE_A_LONGITUDE\' | translate}}</div><div ng-message="max">{{\'MAX_LONGITUDE_IS_180\' | translate}}</div><div ng-message="mix">{{\'MIN_LONGITUDE_IS_M180\' | translate}}</div></div></md-input-container></div></ng-form><md-button ng-click="closeRight()">{{\'CANCEL\' | translate}}</md-button><md-button ng-click="chooseCenter(center)" class="md-primary" ng-disabled="chooseCenterForm.$invalid">{{\'CHOOSE\' | translate}}</md-button></md-content>'),e.put("components/center/arch-map-center-location.html",'<md-toolbar><h1 class="md-toolbar-tools">{{\'BY_GPS\' | translate}}</h1></md-toolbar><md-content class="md-padding"><ng-form name="chooseCenterForm"><div layout="column" style="min-height: 310px;"><p>{{\'PLEASE_START_TYPING_THE_NAME_OF_A_LOCATION_THEN_SELECT_IT\' | translate}}</p><div layout="" layout-sm="column"><md-autocomplete md-selected-item="location.selected" md-search-text="location.search" md-items="item in getMatchLocations(location.search)" md-item-text="item.display_name" md-selected-item-change="extractCenter(item)" md-delay="2000" flex=""><span md-highlight-text="location.search">{{item.display_name}}</span></md-autocomplete><div ng-messages="chooseCenterForm.location.$error" ng-if="chooseCenterForm.location.$dirty"><div ng-message="required">{{\'PLEASE_PROVIDE_A_LOCATION\' | translate}}</div></div></div></div></ng-form><md-button ng-click="closeRight()">{{\'CANCEL\' | translate}}</md-button><md-button ng-click="chooseCenter(center)" class="md-primary" ng-disabled="chooseCenterForm.$invalid">{{\'CHOOSE\' | translate}}</md-button></md-content>'),e.put("components/center/arch-map-center-search.html",'<div layout="row"><md-autocomplete md-selected-item="location.selected" md-search-text="location.search" md-items="item in getMatchLocations(location.search)" md-item-text="item.display_name" md-selected-item-change="extractCenter(item)" md-delay="2000" placeholder="{{\'TYPE_A_LOCATION_NAME\' | translate}}" flex=""><span md-highlight-text="location.search">{{item.display_name}}</span></md-autocomplete></div>'),e.put("components/center/arch-map-side-nav-center-left.html",'<md-toolbar class="md-theme-indigo"><h1 class="md-toolbar-tools">{{\'CHOOSE_CENTER\' | translate}}</h1></md-toolbar><md-content layout="column"><arch-back-button back-state="map.home" layout-fill=""></arch-back-button><md-button class="md-primary" ng-click="setAction(\'gps\')">{{\'BY_GPS\' | translate}}</md-button><md-button class="md-primary" ng-click="setAction(\'location\')">{{\'GIVING_A_LOCATION\' | translate}}</md-button></md-content>'),e.put("components/center/arch-map-side-nav-center-right.html",'<arch-map-center-gps ng-if="actions.gps"></arch-map-center-gps><arch-map-center-location ng-if="actions.location"></arch-map-center-location>'),e.put("components/path/arch-map-side-nav-path-left.html",'<md-sidenav class="md-sidenav-left arch-side-nav" md-component-id="leftSideNav" md-is-locked-open="true"><md-toolbar class="md-theme-indigo"><h1 class="md-toolbar-tools">{{\'PATHS\' | translate}}</h1></md-toolbar><md-content class="arch-side-nav-content md-theme-default"><arch-back-button back-state="map.home" ng-click="removePathControl()"></arch-back-button></md-content></md-sidenav>'),e.put("components/poi/arch-map-side-nav-poi-left.html",'<md-toolbar class="md-theme-indigo"><h1 class="md-toolbar-tools">{{\'POINTS_OF_INTEREST\' | translate}}</h1></md-toolbar><md-content class="md-theme-default" layout="column"><arch-back-button back-state="map.home" layout-fill=""></arch-back-button><md-content class="md-theme-default md-padding">{{\'CLICK_ON_THE_MAP_TO_START\' | translate}}</md-content><md-content class="md-theme-default" ng-show="mapStatus.clicked"><md-button class="md-primary" ng-click="setAction(\'addPoi\')" layout-fill=""><span class="fa fa-plus-circle"></span> {{\'ADD_A_POINT_OF_INTEREST\' | translate}}</md-button></md-content><md-button class="md-primary" ng-click="togglePoisLock()" layout-fill=""><span ng-if="!poisDraggable"><span class="fa fa-unlock"></span> {{\'UNLOCK_POINTS_OF_INTEREST\' | translate}}</span> <span ng-if="poisDraggable"><span class="fa fa-lock"></span> {{\'LOCK_POINTS_OF_INTEREST\' | translate}}</span></md-button><md-button class="md-primary" ng-if="poisDraggable" ng-click="savePois()">{{\'SAVE\' | translate}}</md-button></md-content>'),e.put("components/poi/arch-map-side-nav-poi-right.html",'<arch-poi-add ng-if="actions.addPoi"></arch-poi-add>'),e.put("components/poi/arch-poi-add.html",'<md-toolbar class="md-theme-indigo"><h1 class="md-toolbar-tools">{{\'ADD_A_POINT_OF_INTEREST\' | translate}}</h1></md-toolbar><md-content class="md-padding"><arch-poi-form poi="poi" form-valid="formValid"></arch-poi-form></md-content><md-content class="md-padding"><md-button ng-click="close()">{{\'CANCEL\' | translate}}</md-button><md-button class="md-raised md-primary" ng-click="savePoi()" ng-disabled="!formValid">{{\'ADD\' | translate}}</md-button></md-content>'),e.put("components/poi/arch-poi-delete.html",'<button class="btn btn--m btn--blue btn--raised" lx-ripple="" ng-click="deletePoi()">{{\'DELETE\' | translate}}</button>'),e.put("components/poi/arch-poi-form.html",'<ng-form name="poiForm"><div layout="" layout-sm="column"><md-input-container flex=""><label>{{\'LATITUDE\' | translate}}</label> <input type="text" ng-model="poi.coordinates.latitude" ng-disabled="true"></md-input-container><md-input-container flex=""><label>{{\'LONGITUDE\' | translate}}</label> <input type="text" ng-model="poi.coordinates.longitude" ng-disabled="true"></md-input-container></div><md-input-container flex=""><label>{{\'NAME\' | translate}}</label> <input type="text" ng-model="poi.name" name="name" required=""><div ng-messages="poiForm.name.$error" ng-if="poiForm.name.$invalid && poiForm.name.$dirty"><div ng-message="required">{{\'PLEASE_PROVIDE_A_NAME\' | translate}}</div></div></md-input-container><md-input-container flex=""><label>{{\'DESCRIPTION\' | translate}}</label> <textarea ng-model="poi.description"></textarea></md-input-container><div layout="row" layout-align="center center" class="fill-height"><span flex=""><md-select ng-model="poi.type" flex=""><md-select-label>{{ poi.type ? poi.type.name : (\'SELECT_A_TYPE\' | translate) }}</md-select-label><md-option ng-value="poiType" ng-repeat="poiType in poiTypes">{{poiType.name}}</md-option></md-select></span> <span flex="15">{{\'OR\' | translate}}</span> <span flex=""><md-input-container flex=""><label>{{\'ADD_A_NEW_TYPE\' | translate}}</label> <input type="text" ng-model="newPoiTypeName"></md-input-container></span> <span flex="15"><md-button class="md-primary" ng-disabled="!newPoiTypeName" ng-click="addPoiType(newPoiTypeName)">{{\'ADD\' | translate}}</md-button></span></div></ng-form>'),e.put("components/subscribe/arch-subscribe.html",'<form role="form" class="contactForm validateIt" data-email-subject="Contact Form" data-show-errors="true"><div class="row"><div class="col-md-6 col-sm-6"><div class="form-group"><input required="" type="text" name="field[]" class="form-control input-lg" placeholder="First Name"></div><div class="form-group"><input required="" type="email" name="field[]" class="form-control input-lg" placeholder="E-mail"></div><div class="form-group"><input required="" type="password" name="field[]" class="form-control input-lg" placeholder="Password"></div></div><div class="col-md-6 col-sm-6"><div class="form-group"><input required="" type="text" name="field[]" class="form-control input-lg" placeholder="Last Name"></div><div class="form-group"><input required="" type="phone" name="field[]" class="form-control input-lg" placeholder="Téléphone"></div><div class="form-group"><input required="" type="password" name="field[]" class="form-control input-lg" placeholder="Confirm password"></div></div><div class="col-md-12 col-sm-12"><button type="submit" class="btn btn-default btn-lg btn-block">M\'inscrire !</button></div></div></form>'),e.put("components/tip/arch-tip.html",'<span class="smaller">{{message}}</span>')
}]);